#include "Adafruit_mfGFX.h"
#include "Adafruit_HX8357.h"
#include "SdFat.h"

#define SD_CS D6
#define TFT_RST A0
#define TFT_DC A1
#define TFT_CS A2
#define pinLite D3

SdFat sd;
Adafruit_HX8357 display = Adafruit_HX8357(TFT_CS, TFT_DC, TFT_RST);
File file;

const uint8_t originalCOMICS_8Bitmaps[] =
{
	0x20, 0x7F,		// Start Character, End Character
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00,
	0x00, 0xA0, 0xA0, 0xA0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x11, 0x00, 0x11, 0x00, 0x7F, 0x80, 0x22, 0x00, 0x22, 0x00, 0xFF, 0x00, 0x44, 0x00, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x20, 0x78, 0xA0, 0xA0, 0x70, 0x28, 0x28, 0x28, 0xF0, 0x20, 0x20, 0x00,
	0x02, 0x00, 0x66, 0x00, 0x94, 0x00, 0x9C, 0x00, 0x68, 0x00, 0x1B, 0x00, 0x14, 0x80, 0x34, 0x80, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x18, 0x28, 0x30, 0x74, 0xD4, 0x8C, 0x88, 0x74, 0x00, 0x00, 0x00,
	0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x20, 0x40, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x40, 0x20, 0x00,
	0x80, 0x40, 0x40, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x40, 0x80, 0x00,
	0x00, 0x20, 0xF8, 0x70, 0xD0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00,
	0x08, 0x10, 0x10, 0x10, 0x20, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0x40, 0xC0, 0x40, 0x40, 0x40, 0x40, 0x40, 0xE0, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x88, 0x08, 0x10, 0x20, 0x40, 0x80, 0xF8, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x88, 0x08, 0x70, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0x08, 0x18, 0x28, 0x28, 0x48, 0xFC, 0x08, 0x08, 0x00, 0x00, 0x00,
	0x00, 0xF8, 0x80, 0xF0, 0x88, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x20, 0x40, 0xF0, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0xFC, 0x08, 0x10, 0x10, 0x20, 0x20, 0x20, 0x40, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0x70, 0x88, 0x88, 0x88, 0x78, 0x10, 0x20, 0xC0, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x20, 0x40, 0x80, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x80, 0x40, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0xF0, 0x08, 0x08, 0x10, 0x20, 0x40, 0x00, 0x40, 0x00, 0x00, 0x00,
	0x3E, 0x00, 0x41, 0x00, 0x9C, 0x80, 0xB6, 0x80, 0xA6, 0x80, 0x9B, 0x00, 0x80, 0x00, 0x41, 0x00, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x08, 0x08, 0x14, 0x24, 0x3C, 0x44, 0x42, 0x82, 0x00, 0x00, 0x00,
	0x00, 0xF0, 0x88, 0x88, 0x90, 0xF0, 0x88, 0x88, 0xF0, 0x00, 0x00, 0x00,
	0x00, 0x1C, 0x24, 0x40, 0x80, 0x80, 0x80, 0x84, 0x78, 0x00, 0x00, 0x00,
	0x00, 0xC0, 0xB0, 0x88, 0x84, 0x84, 0x84, 0x88, 0xF0, 0x00, 0x00, 0x00,
	0x00, 0xF8, 0x80, 0x80, 0xF8, 0x80, 0x80, 0x80, 0xF8, 0x00, 0x00, 0x00,
	0x00, 0xF8, 0x80, 0x80, 0xF0, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x1C, 0x22, 0x40, 0x80, 0xBE, 0x82, 0x84, 0x78, 0x00, 0x00, 0x00,
	0x00, 0x84, 0x84, 0x84, 0xFC, 0x84, 0x84, 0x84, 0x84, 0x00, 0x00, 0x00,
	0x00, 0xF8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xF8, 0x00, 0x00, 0x00,
	0x00, 0x3E, 0x08, 0x08, 0x08, 0x08, 0x88, 0x88, 0x78, 0x00, 0x00, 0x00,
	0x00, 0x88, 0x90, 0xA0, 0xC0, 0xC0, 0xA0, 0x90, 0x88, 0x00, 0x00, 0x00,
	0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xF0, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x22, 0x00, 0x22, 0x00, 0x22, 0x00, 0x55, 0x00, 0x55, 0x00, 0x55, 0x00, 0x88, 0x80, 0x88, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x82, 0xC2, 0xA2, 0xA2, 0x92, 0x8A, 0x86, 0x82, 0x00, 0x00, 0x00,
	0x00, 0x3C, 0x42, 0x82, 0x82, 0x82, 0x82, 0x84, 0x78, 0x00, 0x00, 0x00,
	0x00, 0xE0, 0x90, 0x90, 0x90, 0x90, 0xE0, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x3C, 0x42, 0x81, 0x81, 0x81, 0x91, 0x4A, 0x3E, 0x03, 0x01, 0x00,
	0x00, 0xE0, 0x90, 0x90, 0x90, 0xE0, 0xA0, 0x90, 0x88, 0x00, 0x00, 0x00,
	0x00, 0x3C, 0x40, 0x40, 0x38, 0x04, 0x04, 0x84, 0x78, 0x00, 0x00, 0x00,
	0x00, 0xFE, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00, 0x00,
	0x00, 0x84, 0x84, 0x84, 0x84, 0x84, 0x84, 0x84, 0x78, 0x00, 0x00, 0x00,
	0x00, 0x88, 0x88, 0x88, 0x50, 0x50, 0x50, 0x50, 0x20, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x84, 0x20, 0x84, 0x20, 0x4A, 0x40, 0x4A, 0x40, 0x52, 0x80, 0x52, 0x80, 0x22, 0x80, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x82, 0x44, 0x28, 0x10, 0x10, 0x28, 0x44, 0x82, 0x00, 0x00, 0x00,
	0x00, 0x84, 0x48, 0x48, 0x28, 0x30, 0x10, 0x20, 0x20, 0x00, 0x00, 0x00,
	0x00, 0xFE, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0xFE, 0x00, 0x00, 0x00,
	0xE0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xE0, 0x00,
	0x00, 0x80, 0x80, 0x40, 0x40, 0x20, 0x20, 0x20, 0x10, 0x10, 0x00, 0x00,
	0xE0, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xE0, 0x00,
	0x60, 0x60, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x00,
	0x80, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x38, 0x48, 0x88, 0x88, 0x88, 0x74, 0x00, 0x00, 0x00,
	0x80, 0x80, 0x80, 0xF0, 0x88, 0x88, 0x88, 0x88, 0xF0, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x30, 0x48, 0x80, 0x80, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x08, 0x08, 0x08, 0x78, 0x88, 0x88, 0x88, 0x88, 0x78, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x70, 0x88, 0x90, 0xE0, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x18, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x30, 0x48, 0x88, 0x88, 0x88, 0x78, 0x08, 0x10, 0xE0,
	0x80, 0x80, 0x80, 0xB0, 0xC8, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00,
	0x00, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x10, 0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x90, 0x60,
	0x80, 0x80, 0x80, 0x88, 0x90, 0xA0, 0xE0, 0x90, 0x88, 0x00, 0x00, 0x00,
	0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0xA4, 0xDA, 0x92, 0x92, 0x92, 0x92, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0xB0, 0xC8, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0xF0, 0x88, 0x88, 0x88, 0x88, 0xF0, 0x80, 0x80, 0x80,
	0x00, 0x00, 0x00, 0x38, 0x48, 0x88, 0x88, 0x88, 0x78, 0x08, 0x08, 0x08,
	0x00, 0x00, 0x00, 0xE0, 0xA0, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x70, 0x80, 0x40, 0x20, 0x10, 0xE0, 0x00, 0x00, 0x00,
	0x00, 0x40, 0x40, 0xE0, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x88, 0x78, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x88, 0x88, 0x50, 0x50, 0x20, 0x20, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x92, 0x92, 0xB4, 0xB4, 0x54, 0x48, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x84, 0x48, 0x30, 0x30, 0x48, 0x84, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x84, 0x88, 0x48, 0x50, 0x30, 0x20, 0x20, 0x40, 0x40,
	0x00, 0x00, 0x00, 0xF0, 0x10, 0x20, 0x40, 0x80, 0xF0, 0x00, 0x00, 0x00,
	0x30, 0x40, 0x40, 0x40, 0x40, 0xC0, 0x40, 0x40, 0x40, 0x40, 0x30, 0x00,
	0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00,
	0xC0, 0x20, 0x20, 0x20, 0x20, 0x30, 0x20, 0x20, 0x20, 0x20, 0xC0, 0x00,
	0x00, 0x00, 0x00, 0x64, 0xE4, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

void pinInitialization()
{
	//*** Initialize Photon Pin Modes
	pinMode(TFT_RST, OUTPUT);
	pinMode(SD_CS, OUTPUT);
	pinMode(TFT_DC, OUTPUT);
	pinMode(TFT_CS, OUTPUT);
	pinMode(A3, OUTPUT); //CLK
	pinMode(A5, OUTPUT); //MOSI

	//*** Initialize Photon Pin Values
	digitalWrite(TFT_RST, LOW);
	digitalWrite(SD_CS, LOW);
	digitalWrite(TFT_DC, LOW);
	digitalWrite(TFT_CS, LOW);
	digitalWrite(A3, LOW); //CLK
	digitalWrite(A5, LOW); //MOSI
}

STARTUP( pinInitialization() );

void setup() {
  //Initialize LCD
  analogWrite(pinLite, 250); // Needs to go before screen initializes
	display.begin(HX8357D);
	display.setRotation(1);
	display.setFont(GLCDFONT);
	display.fillRect(0, 0, 480, 320, HX8357_BLACK);

  //Initialize SD
  if (!sd.begin(SD_CS)) {
    display.println("Error: SD Init");
  }
	display.setTextSize(7);
	display.println("Font type 1");

	//Write font "COMICS_8" to SD Card
	if (!file.open("COMICS8BIT.txt", O_CREAT | O_WRITE)) {
    display.println("Error creating file");
  }

	int i = 0;
	int length = sizeof(originalCOMICS_8Bitmaps) / sizeof(uint8_t);
	while (i < length) {
		file.print(originalCOMICS_8Bitmaps[i]);
		file.print(',');
		i++;
	}

  file.close();

  //Load font "COMICS_8" from SD Card
	//-Remove constant and values from fonts.cpp array comicSansMS_8ptBitmaps[]
	//-Read values from file
	//-Add entries to the array define on fonts.cpp--> uint8_t comicSansMS_8ptBitmaps[]

  //Test second font
	display.setFont(COMICS_8);
	display.println("Font type 2");
}

void loop() {
  // nothing happens after setup
}
